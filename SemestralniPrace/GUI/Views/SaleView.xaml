<UserControl x:Class="GUI.Views.SaleView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             Background="White"
             d:DesignHeight="600" d:DesignWidth="1000">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <!-- Hlavička -->
        <StackPanel Grid.Row="0" Grid.ColumnSpan="2"
            Orientation="Horizontal"
            VerticalAlignment="Center"
            Margin="0,0,0,10">

            <TextBlock Text="Prodeje"
               FontSize="24"
               FontWeight="Bold"
               VerticalAlignment="Center"/>

            <TextBox Width="260"
             Margin="20,0,0,0"
             VerticalAlignment="Center"
             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
             ToolTip="Hledat (cena, datum, karta, účet)"/>
        </StackPanel>

        <!-- Levá strana – seznam prodejů -->
        <DataGrid Grid.Row="1" Grid.Column="0"
                  ItemsSource="{Binding Sales}"
                  SelectedItem="{Binding SelectedSale, Mode=TwoWay}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  Margin="0,0,10,0">
            <DataGrid.Columns>
                <!--<DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="Auto"/>-->
                <DataGridTextColumn Header="Cena" Binding="{Binding Price}" Width="*"/>
                <DataGridTextColumn Header="Datum prodeje" Binding="{Binding DateOfSale, StringFormat=\{0:d\}}" Width="*"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Pravá strana – detail prodeje -->
        <Grid Grid.Row="1" Grid.Column="1" Margin="10,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <!-- detail + díla -->
                <RowDefinition Height="Auto"/>
                <!-- hlavní tlačítka -->
            </Grid.RowDefinitions>

            <!-- Scrollovatelný obsah -->
            <ScrollViewer Grid.Row="0"
                          VerticalScrollBarVisibility="Auto">
                <StackPanel>

                    <TextBlock Text="Detail prodeje"
                               FontSize="18"
                               FontWeight="Bold"
                               Margin="0,0,0,10"/>

                    <!-- Cena -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock Text="Cena:" Width="140"/>
                        <TextBox Text="{Binding SelectedSale.Price, UpdateSourceTrigger=PropertyChanged}"
                                 Width="100"/>
                    </StackPanel>

                    <!-- Datum prodeje -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock Text="Datum prodeje:" Width="140"/>
                        <DatePicker SelectedDate="{Binding SelectedSale.DateOfSale, UpdateSourceTrigger=PropertyChanged}"
                                    Width="200"/>
                    </StackPanel>

                    <!-- Číslo karty -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock Text="Číslo karty:" Width="140"/>
                        <TextBox Text="{Binding SelectedSale.CardNumber, UpdateSourceTrigger=PropertyChanged}"
                                 Width="200"/>
                    </StackPanel>

                    <!-- Číslo účtu -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBlock Text="Číslo účtu:" Width="140"/>
                        <TextBox Text="{Binding SelectedSale.AccountNumber, UpdateSourceTrigger=PropertyChanged}"
                                 Width="200"/>
                    </StackPanel>

                    <!-- Typ platby -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <TextBlock Text="Typ platby:" Width="140"/>
                        <ComboBox Width="200"
                                  ItemsSource="{Binding TypesOfPayment}"
                                 SelectedValue="{Binding SelectedSale.TypeOfPayment.Id, Mode=TwoWay}"
                                SelectedValuePath="Id"
                                DisplayMemberPath="Name" />
                    </StackPanel>

                    <!-- Kupující -->
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                        <TextBlock Text="Kupující:" Width="140"/>
                        <ComboBox Width="250"
                                  ItemsSource="{Binding Buyers}"
                                  SelectedValue="{Binding SelectedSale.Buyer.Id, Mode=TwoWay}"
                                SelectedValuePath="Id"
                                DisplayMemberPath="FullName"/>
                        
                        
                        <!-- pokud máš FullName, změň DisplayMemberPath -->
                    </StackPanel>

                    <!-- Umělecká díla v prodeji -->
                    <TextBlock Text="Prodávaná umělecká díla:"
                               Margin="0,15,0,5"/>

                    <DataGrid ItemsSource="{Binding SaleArtPieces}"
                              SelectedItem="{Binding SelectedArtPieceToRemove, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              Height="150"
                              Margin="0,0,0,5">
                        <DataGrid.Columns>
                            <!--<DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="Auto"/>-->
                            <DataGridTextColumn Header="Název" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="Typ díla" Binding="{Binding TypeToString}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Přidávání / odebírání díla -->
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                        <TextBlock Text="Přidat dílo:" Width="120" VerticalAlignment="Center"/>

                        <ComboBox Width="250"
                                  ItemsSource="{Binding AvailableArtPieces}"
                                  SelectedItem="{Binding SelectedArtPieceToAdd, Mode=TwoWay}"
                                  DisplayMemberPath="Name"
                                  Margin="0,0,10,0"/>

                        <Button Content="Přidat"
                                Width="80"
                                Margin="0,0,5,0"
                                Command="{Binding AddArtPieceCommand}"/>

                        <Button Content="Odebrat vybrané"
                                Width="110"
                                Command="{Binding RemoveArtPieceCommand}"/>
                    </StackPanel>

                </StackPanel>
            </ScrollViewer>

            <!-- Hlavní CRUD tlačítka pro prodej – vždy viditelná -->
            <StackPanel Grid.Row="1"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,10,0,0">
                <Button Content="Nový"
                        Command="{Binding NewCommand}"
                        Margin="0,0,10,0"
                        Width="80"/>
                <Button Content="Uložit"
                        Command="{Binding SaveCommand}"
                        Margin="0,0,10,0"
                        Width="80"/>
                <Button Content="Smazat"
                        Command="{Binding DeleteCommand}"
                        Width="80"/>
            </StackPanel>

        </Grid>
    </Grid>
</UserControl>
